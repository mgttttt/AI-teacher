const faqList = [
  {
    "question": "Могут ли поступающие с аттестатом о среднем общем образовании в случае неуспешной сдачи ЕГЭ сдать вступительные испытания при университете?",
    "answer": "Нет, не могут. Поступающие по окончании 11-го класса с аттестатом о среднем общем образовании при подаче документов для поступления в высшее учебное заведение обязаны предоставить результаты единых государственных экзаменов."
},
{
    "question": "Какие баллы являются проходными для поступления в СурГУ?",
    "answer": "СурГУ не устанавливает проходные баллы. Значение проходного балла не является постоянным, оно меняется каждый год в зависимости от количества бюджетных мест и количества поступающих. Определены минимальные баллы по каждому предмету."
},
{
    "question": "Действительны ли в СурГУ результаты вступительных испытаний, полученные в других вузах?",
    "answer": "Нет, не действительны. Вступительные испытания, необходимые для поступления в СурГУ на ряд направлений и специальностей, необходимо пройти в нашем вузе."
},
{
    "question": "Есть ли возможность обучаться в СурГУ по образовательным программам бакалавриата/специалитета посредством ЭОиДОТ?",
    "answer": "ЭОиДОТ используется при всех предусмотренных законодательством Российской Федерации формах получения образования или при их сочетании, при проведении различных видов учебных, лабораторных и практических занятий, практик, текущего контроля, промежуточной аттестации обучающихся. Применение ЭОиДОТ не исключает возможности проведения учебных, лабораторных и практических занятий, практик, текущего контроля, промежуточной аттестации путем непосредственного взаимодействия преподавателей с обучающимся."
},
{
    "question": "В какие сроки нужно подать документы для поступления?",
    "answer": "Способы и сроки и подачи документов:\na) представляются лично поступающим по адресу пр. Ленина, 1 по предварительной записи (записаться нужно через Личный кабинет поступающего);\nб) направляются через операторов почтовой связи общего пользования (с уведомлением);\nв) направляются в электронной форме посредством электронной информационной системы СурГУ (Личный кабинет поступающего), а также документы на обучение по программам бакалавриата и программам специалитета направляются посредством федеральной государственной информационной системы «Единый портал государственных и муниципальных услуг (функций)» при поступлении на обучение через суперсервис «Поступление в вуз онлайн».\nВ 2023 году подавать документы можно до получения результатов ЕГЭ."
},
{
    "question": "Можно ли подать документы для поступления, если известны не все результаты ЕГЭ?",
    "answer": "Можно. Университет самостоятельно проверяет результаты ЕГЭ."
},
{
    "question": "Сколько лет действительны результаты ЕГЭ?",
    "answer": "При приеме на обучение по программам бакалавриата и программам специалитета результаты ЕГЭ действительны в течение четырёх лет, следующих за годом их получения. В 2023 году действительными являются результаты, полученные не ранее 2019 года."
},
{
    "question": "Можно ли при поступлении подать документы одновременно на бюджетную и внебюджетную основу обучения?",
    "answer": "Да, можно одновременно подать документы как на бюджетную, так и внебюджетную основу обучения и параллельно участвовать в конкурсах при поступлении."
},
{
    "question": "Можно ли поступить в Институт среднего специального образования после 9 класса?",
    "answer": "Нет. Прием документов для поступления в медицинский колледж осуществляется только после 11-го класса при наличии аттестата о среднем общем образовании, либо диплома о среднем профессиональном образовании на базе основного общего образования."
},
{
    "question": "Что такое медицинская справка формы 086-у и где ее можно получить?",
    "answer": "Медицинская справка формы 086-у – это унифицированная справка, которую оформляют в медицинских учреждениях. Справка отображает общее состояние здоровья человека, содержит сведения о пригодности проходить обучение в высшем учебном заведении."
},
{
    "question": "Можно ли суммировать баллы за индивидуальные достижения с результатом одного из экзаменов ЕГЭ, чтобы достичь установленного для поступления минимума баллов?",
    "answer": "Нет. Баллы за индивидуальные достижения прибавляются только к сумме конкурсных баллов, но не к результату какого-то одного экзамена ЕГЭ отдельно."
},
{
    "question": "Засчитываются ли результаты выпускных экзаменов, полученные в образовательных учреждениях иностранных государств, в качестве результатов ЕГЭ при поступлении в российский вуз?",
    "answer": "Нет. В российских вузах результаты выпускных экзаменов, полученные в образовательных учреждениях иностранных государств, не засчитываются в качестве результатов ЕГЭ."
},
{
    "question": "Как узнать, какую математику – профильную или базовую – нужно сдать во время ЕГЭ, чтобы поступить на выбранное мною направление?",
    "answer": "Если в списке вступительных испытаний на выбранное Вами направление указана математика, то это всегда профильная математика."
},
{
    "question": "Если поступающий окончил школу, когда еще не сдавали ЕГЭ, имеет ли он право пройти вступительные испытания в вузе?",
    "answer": "Нет, не имеет. Независимо от того, в каком году поступающий окончил школу, для поступления в образовательную организацию высшего образования при наличии аттестата о среднем общем образовании поступающий должен сдать ЕГЭ."
},
{
    "question": "С каким баллом аттестата можно поступить в Институт среднего специального образования на бюджетную форму обучения?",
    "answer": "СурГУ не устанавливает проходной балл аттестата для поступления в Институт среднего специального образования."
}
];

function convertToSpeech() {
  const inputTextElement = document.getElementById('inputText');
  const inputText = inputTextElement.value.trim();

  if (!inputText) {
      return; 
  }

  inputTextElement.value = '';

  addMessageToChat('Вы', inputText);

  fetch('/texttospeech', {
      method: 'POST',
      headers: {
          'Content-Type': 'application/json'
      },
      body: JSON.stringify({ text: inputText })
  })
  .then(response => response.json())
  .then(data => {
      if (data.audio_base64) {
          addMessageToChat('ИИ Преподаватель', data.answer);

          const idleVideo = document.getElementById('idleVideo');
          const activeVideo = document.getElementById('activeVideo');

          const audioBlob = b64toBlob(data.audio_base64);
          const audioUrl = URL.createObjectURL(audioBlob);
          const audio = new Audio(audioUrl);

          audio.onplay = function() {
              idleVideo.style.display = 'none';
              activeVideo.style.display = 'block';
              activeVideo.play();
          };

          audio.onended = function() {
              activeVideo.style.display = 'none';
              activeVideo.pause();
              activeVideo.currentTime = 0; 
              idleVideo.style.display = 'block';
              idleVideo.play();
          };

          audio.play();
      }
  })
  .catch(error => {
      console.error('Ошибка:', error);
      alert('Произошла ошибка при обработке запроса.');
  });
}

function addMessageToChat(sender, message) {
  const chatHistory = document.getElementById('chatHistory');
  const messageElement = document.createElement('div');
  messageElement.classList.add('chat-message');

  if (sender === 'Вы') {
      messageElement.classList.add('user-message');
  } else {
      messageElement.classList.add('assistant-message');
  }

  messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
  chatHistory.appendChild(messageElement);

  chatHistory.scrollTop = chatHistory.scrollHeight;
}

function openFAQModal() {
  const faqModal = document.getElementById('faqModal');
  faqModal.style.display = 'block';
}

function closeFAQModal() {
  const faqModal = document.getElementById('faqModal');
  faqModal.style.display = 'none';
}

function displayFAQ() {
  const faqContainer = document.getElementById('faqList');
  faqContainer.innerHTML = ''; 

  faqList.forEach((faq, index) => {
      const faqItem = document.createElement('div');
      faqItem.classList.add('faq-item');
      faqItem.textContent = faq.question;
      faqItem.onclick = () => handleFAQClick(index);
      faqContainer.appendChild(faqItem);
  });
}

function handleFAQClick(index) {
  const question = faqList[index].question;
  closeFAQModal();
  document.getElementById('inputText').value = question;
  convertToSpeech();
}

window.onclick = function(event) {
  const faqModal = document.getElementById('faqModal');
  if (event.target == faqModal) {
      faqModal.style.display = 'none';
  }
}

function b64toBlob(base64) {
  const byteString = atob(base64);
  const ab = new ArrayBuffer(byteString.length);
  const ia = new Uint8Array(ab);
  for (let i = 0; i < byteString.length; i++) {
      ia[i] = byteString.charCodeAt(i);
  }
  return new Blob([ab], { type: 'audio/mpeg' });
}

window.onload = function() {
  displayFAQ();
}
